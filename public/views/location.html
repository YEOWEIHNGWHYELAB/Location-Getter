<!DOCTYPE html>
<html>

<head>
  
</head>

<head>
  <title>Automatic Location Upload</title>
</head>

<body>
  <h1>Automatic Location Upload</h1>

  <p>Welcome, <span id="username"></span>!</p>

  <p>Last sent location: <span id="last-location"></span></p>

  <button onclick="startSending()">Start Sending Location</button>

  <p>OR</p>

  <form action="/location" method="POST">
    <div>Upload your Location Manually Here</div>
    <div>
      <label for="latitude">Latitude:</label>
      <input type="number" id="latitude" name="latitude" required step="any">
    </div>
    <div>
      <label for="longitude">Longitude:</label>
      <input type="number" id="longitude" name="longitude" required step="any">
    </div>
    <br>
    <div>
      <input type="submit" value="Upload Location">
    </div>
  </form>

  <br>

  <div>
    <div>Logout Here</div>
    <form action="/auth/logout" method="POST">
      <div>
        <input type="submit" value="Logout">
      </div>
    </form>
  </div>

  <script>
		// Function to read cookie
		function getCookie(name) {
			const value = `; ${document.cookie}`;
			const parts = value.split(`; ${name}=`);
			if (parts.length === 2) return parts.pop().split(';').shift();
		}

		// Get username cookie value
		const username = getCookie("username");

		// Display username on page
		document.getElementById("username").textContent = username;

    // Function to send location to server
		function sendLocation(latitude, longitude) {
			fetch('/location', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json'
				},
				body: JSON.stringify({
					latitude: latitude,
					longitude: longitude,
				})
			})
			.then(response => {
				// console.log(response);
				document.getElementById("last-location").textContent = latitude + ", " + longitude;
			})
			.catch(error => console.error(error));
		}

		// Function to get user's location and send it to server
		function getLocationAndSend() {
			if (navigator.geolocation) {
				navigator.geolocation.getCurrentPosition(position => {
					const latitude = position.coords.latitude;
					const longitude = position.coords.longitude;
					sendLocation(latitude, longitude);
				});
			} else {
				console.error("Geolocation is not supported by this browser.");
			}
		}

		// Start sending location every second when button is clicked
		function startSending() {
			setInterval(() => {
				getLocationAndSend();
			}, 1000);
		}
	</script>
</body>

</html>